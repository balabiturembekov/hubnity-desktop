# E2E Тестирование Hubnity

## Быстрый старт

### 1. Установка зависимостей

```bash
pnpm install
npx playwright install
```

### 2. Запуск тестов

```bash
# Запуск всех E2E тестов
pnpm test:e2e

# Запуск с UI (рекомендуется для первого раза)
pnpm test:e2e:ui

# Запуск в headed режиме (с видимым браузером)
pnpm test:e2e:headed

# Запуск в debug режиме (пошаговое выполнение)
pnpm test:e2e:debug
```

## Что тестируется

### ✅ Полный цикл пользователя (`full-user-cycle.spec.ts`)
- Логин с валидацией
- Выбор проекта
- Старт трекинга
- Пауза трекинга
- Возобновление трекинга
- Стоп трекинга
- Отображение времени
- Сохранение накопленного времени в localStorage

### ✅ Смена дня (`day-change.spec.ts`)
- Сброс таймера в полночь
- Работа через полночь
- Пауза до полуночи, возобновление после

### ✅ URL Activity Tracking (`url-activity.spec.ts`)
- Отслеживание URL активности
- Отправка URL activities в батчах
- Очистка при смене дня

### ✅ Накопление времени за день (`accumulated-time.spec.ts`)
- Сохранение времени при остановке
- Восстановление времени при повторном запуске
- Проверка localStorage для накопленного времени

### ✅ Окно простоя (Idle Window) (`idle-window.spec.ts`)
- Появление окна простоя при неактивности
- Обратный отсчет времени простоя
- Кнопки возобновления и остановки
- Проверка, что скриншоты не делаются при простое

## Структура тестов

```
e2e/
├── full-user-cycle.spec.ts    # Основной цикл пользователя
├── day-change.spec.ts          # Тесты смены дня
├── url-activity.spec.ts        # Тесты URL tracking
├── accumulated-time.spec.ts    # Тесты накопления времени за день
├── idle-window.spec.ts         # Тесты окна простоя
└── README.md                   # Детальная документация
```

## Статистика тестов

- **Всего тестов:** 9
- **Пройдено:** 9 ✅
- **Провалено:** 0
- **Время выполнения:** ~15 секунд

## Примечания

1. **Моки**: Тесты используют моки для Tauri команд и API, поэтому не требуют реального бэкенда
2. **Время**: Некоторые тесты требуют ожидания (например, отправка URL activities каждую минуту)
3. **Смена дня**: Тестирование смены дня требует специальной настройки моков времени

## Улучшения для продакшена

- [ ] Добавить тесты для скриншотов
- [ ] Добавить тесты для idle detection
- [ ] Добавить тесты для обработки ошибок сети
- [ ] Добавить тесты для refresh token
- [ ] Использовать реальный Tauri dev server (если возможно)
- [ ] Добавить CI/CD интеграцию

## Troubleshooting

### Тесты не запускаются
- Убедитесь, что установлены все зависимости: `pnpm install`
- Убедитесь, что установлены браузеры: `npx playwright install`

### Тесты падают с ошибкой подключения
- Убедитесь, что dev сервер запущен на порту 1420
- Проверьте, что нет конфликтов портов

### Тесты работают медленно
- Используйте `--workers=1` для последовательного выполнения
- Уменьшите таймауты в тестах (если возможно)
