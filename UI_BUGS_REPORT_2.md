# UI BUGS REPORT #2

**–î–∞—Ç–∞:** 2025-01-08  
**–°—Ç–∞—Ç—É—Å:** –ù–∞–π–¥–µ–Ω–æ 6 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤

---

## üî¥ BUG #6: –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ Timer.tsx

**–§–∞–π–ª:** `src/components/Timer.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 73-77

**–ü—Ä–æ–±–ª–µ–º–∞:**
`catch` –±–ª–æ–∫ –Ω–µ –∑–∞–∫—Ä—ã—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–∫—Ä—ã–≤–∞—é—â–∞—è —Å–∫–æ–±–∫–∞ –¥–ª—è `try`.

**–ö–æ–¥:**
```typescript
} catch (error) {
  console.error('[TIMER] Failed to get timer state:', error);
  // –ù–µ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–µ
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `try` –±–ª–æ–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–∫—Ä—ã—Ç.

---

## üî¥ BUG #7: Heartbeat –∏—Å–ø–æ–ª—å–∑—É–µ—Ç store –≤–º–µ—Å—Ç–æ timerState

**–§–∞–π–ª:** `src/App.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 153-164

**–ü—Ä–æ–±–ª–µ–º–∞:**
Heartbeat –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `isTracking` –∏ `isPaused` –∏–∑ store, –∞ –Ω–µ –∏–∑ Rust Timer Engine. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ heartbeat, –∫–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Rust.

**–ö–æ–¥:**
```typescript
heartbeatInterval = setInterval(async () => {
  if (!isCleanedUp) {
    const { isTracking, isPaused } = useTrackerStore.getState();
    if (isTracking && !isPaused) {
      try {
        await api.sendHeartbeat(true);
      } catch (error) {
        console.error('Failed to send heartbeat:', error);
      }
    }
  }
}, 60000);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Store –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Rust Timer Engine
- Heartbeat –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è, –∫–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Rust
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ `TimerEngineAPI.getState()` –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π heartbeat.

---

## üî¥ BUG #8: URL Tracking –∏—Å–ø–æ–ª—å–∑—É–µ—Ç store –≤–º–µ—Å—Ç–æ timerState

**–§–∞–π–ª:** `src/App.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 245-262

**–ü—Ä–æ–±–ª–µ–º–∞:**
URL tracking –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `isTracking` –∏ `isPaused` –∏–∑ store, –∞ –Ω–µ –∏–∑ Rust Timer Engine. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é URL, –∫–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Rust.

**–ö–æ–¥:**
```typescript
const trackUrlActivity = async () => {
  if (isCleanedUp) return;
  
  const { isTracking, isPaused, currentTimeEntry } = useTrackerStore.getState();
  
  // Only track if tracking is active and not paused
  if (!isTracking || isPaused || !currentTimeEntry) {
    // ...
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Store –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å Rust Timer Engine
- URL –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å—Å—è, –∫–æ–≥–¥–∞ —Ç–∞–π–º–µ—Ä —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Rust
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ —á–µ—Ä–µ–∑ `TimerEngineAPI.getState()` –ø–µ—Ä–µ–¥ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º URL.

---

## üü° BUG #9: ScreenshotsView - refreshScreenshots –Ω–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

**–§–∞–π–ª:** `src/components/ScreenshotsView.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 26-41

**–ü—Ä–æ–±–ª–µ–º–∞:**
`refreshScreenshots` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `useEffect`, –Ω–æ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –≤–µ—Ä—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏.

**–ö–æ–¥:**
```typescript
useEffect(() => {
  if (!timeEntryId) return;
  
  const handleScreenshotUploaded = () => {
    setTimeout(() => {
      refreshScreenshots(); // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –Ω–æ –Ω–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
    }, 1000);
  };

  window.addEventListener('screenshot:uploaded', handleScreenshotUploaded);
  return () => {
    window.removeEventListener('screenshot:uploaded', handleScreenshotUploaded);
  };
  // eslint-disable-next-line react-hooks/exhaustive-deps
}, [timeEntryId]); // refreshScreenshots –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `refreshScreenshots` –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π –≤–µ—Ä—Å–∏–µ–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `timeEntryId`
- ESLint –ø—Ä–∞–≤–∏–ª–æ –æ—Ç–∫–ª—é—á–µ–Ω–æ, —á—Ç–æ —Å–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É

**–†–µ—à–µ–Ω–∏–µ:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `useCallback` –¥–ª—è `refreshScreenshots` –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

---

## üü° BUG #10: –ò–∑–±—ã—Ç–æ—á–Ω—ã–π polling –≤ IdleWindow

**–§–∞–π–ª:** `src/components/IdleWindow.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 94-101

**–ü—Ä–æ–±–ª–µ–º–∞:**
Polling –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–º –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É.

**–ö–æ–¥:**
```typescript
// Also poll state periodically as fallback (every 2 seconds)
pollInterval = setInterval(async () => {
  try {
    await invoke('request_idle_state');
  } catch (error) {
    // Ignore errors
  }
}, 2000);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 2 —Å–µ–∫—É–Ω–¥—ã - –æ—á–µ–Ω—å —á–∞—Å—Ç–æ –¥–ª—è polling
- –°–æ–∑–¥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–∏—Å—Ç–µ–º—É
- Event-based –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏

**–†–µ—à–µ–Ω–∏–µ:**
–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 5-10 —Å–µ–∫—É–Ω–¥ –∏–ª–∏ —É–±—Ä–∞—Ç—å polling, –ø–æ–ª–∞–≥–∞—è—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–æ–±—ã—Ç–∏—è.

---

## üü° BUG #11: –ò–∑–±—ã—Ç–æ—á–Ω—ã–π polling –≤ App.tsx –¥–ª—è screenshots

**–§–∞–π–ª:** `src/App.tsx`  
**–°—Ç—Ä–æ–∫–∏:** 649-653

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è screenshots –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω–æ–π.

**–ö–æ–¥:**
```typescript
// Check periodically (every 2 seconds) to handle state changes more responsively
const checkInterval = setInterval(() => {
  if (!isCleanedUp) {
    checkAndStartScreenshots().catch(() => {});
  }
}, 2000); // Check every 2 seconds for faster response
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 2 —Å–µ–∫—É–Ω–¥—ã - –æ—á–µ–Ω—å —á–∞—Å—Ç–æ
- –°–æ–∑–¥–∞–µ—Ç –Ω–µ–Ω—É–∂–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
- Store subscription –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º

**–†–µ—à–µ–Ω–∏–µ:**
–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–æ 5-10 —Å–µ–∫—É–Ω–¥ –∏–ª–∏ —É–±—Ä–∞—Ç—å polling, –ø–æ–ª–∞–≥–∞—è—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ store subscription.

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
1. **BUG #6**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –≤ Timer.tsx
2. **BUG #7**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timerState –¥–ª—è heartbeat
3. **BUG #8**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å timerState –¥–ª—è URL tracking

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
4. **BUG #9**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ ScreenshotsView
5. **BUG #10**: –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É polling –≤ IdleWindow
6. **BUG #11**: –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É polling –≤ App.tsx

---

## üìù –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫—É—é –æ—à–∏–±–∫—É –≤ Timer.tsx
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `TimerEngineAPI.getState()` –¥–ª—è heartbeat –∏ URL tracking
3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ ScreenshotsView
4. –£–º–µ–Ω—å—à–∏—Ç—å —á–∞—Å—Ç–æ—Ç—É polling –¥–æ 5-10 —Å–µ–∫—É–Ω–¥

---

**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2025-01-08  
**–ù–∞–π–¥–µ–Ω–æ 6 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∞–≥–æ–≤ –≤ UI**
