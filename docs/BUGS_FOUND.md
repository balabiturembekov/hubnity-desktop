# –ù–∞–π–¥–µ–Ω–Ω—ã–µ –±–∞–≥–∏ (–∞—É–¥–∏—Ç 2025-02-12)

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ / –í–∞–∂–Ω—ã–µ

### 1. `idleThreshold = 0` ‚Äî –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –ø–∞—É–∑–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º checkIdleStatus
**–§–∞–π–ª:** `src/store/useTrackerStore.ts`  
**–ü—Ä–æ–±–ª–µ–º–∞:** `setIdleThreshold` –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ. –ï—Å–ª–∏ `idleThreshold <= 0`, —É—Å–ª–æ–≤–∏–µ `idleTime >= idleThreshold` –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ true ‚Üí —Ç–∞–π–º–µ—Ä —Å—Ä–∞–∑—É —É—Ö–æ–¥–∏—Ç –≤ idle pause.  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π (Settings –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏), –Ω–æ –ø—Ä–∏ –±—É–¥—É—â–∏—Ö –≤—ã–∑–æ–≤–∞—Ö –∏–ª–∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ü–∏–∏ ‚Äî –≤–æ–∑–º–æ–∂–µ–Ω —Å–±–æ–π.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤ `checkIdleStatus`: `if (idleThreshold <= 0) return;` –∏/–∏–ª–∏ –≤ `setIdleThreshold`: `minutes = Math.max(1, minutes)`.

---

### 2. `mark_task_sent_by_id` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–µ –≤–æ–∑–º–æ–∂–µ–Ω –¥—É–±–ª–∏–∫–∞—Ç
**–§–∞–π–ª:** `src/store/useTrackerStore.ts` (—Å—Ç—Ä–æ–∫–∏ 780, 920, 992, 1192, 1386, 1815)  
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `invoke('mark_task_sent_by_id', { id: queueId }).catch(() => {})`. –ü—Ä–∏ –æ—à–∏–±–∫–µ invoke –∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞—ë—Ç—Å—è pending, sync_queue_now –±—É–¥–µ—Ç –µ—ë –ø–æ–≤—Ç–æ—Ä—è—Ç—å ‚Üí –¥—É–±–ª–∏–∫–∞—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.  
**–†–∏—Å–∫:** –°—Ä–µ–¥–Ω–∏–π. –í Rust sync —É–∂–µ –µ—Å—Ç—å retry –¥–ª—è `mark_task_sent`, –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ ‚Äî –Ω–µ—Ç.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å retry (2‚Äì3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π) –ø—Ä–∏ –≤—ã–∑–æ–≤–µ `mark_task_sent_by_id` –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.

---

### 3. `beforeunload` ‚Äî async handler –º–æ–∂–µ—Ç –Ω–µ —É—Å–ø–µ—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å—Å—è
**–§–∞–π–ª:** `src/App.tsx`  
**–ü—Ä–æ–±–ª–µ–º–∞:** `handleBeforeUnload` ‚Äî async, –Ω–æ `beforeunload` –Ω–µ –∂–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è Promise. –ë—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `saveTimerState()`.  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π. –û—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å ‚Äî `tauri://close-requested` –≤ Rust. beforeunload ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞.  
**–†–µ—à–µ–Ω–∏–µ:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `navigator.sendBeacon` –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è).

---

## üü° –°—Ä–µ–¥–Ω–∏–µ

### 4. –î–æ—Å—Ç—É–ø –∫ `sortedEntries[0]` –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏
**–§–∞–π–ª:** `src/App.tsx:268`  
**–ü—Ä–æ–±–ª–µ–º–∞:** `const activeEntry = sortedEntries[0];` ‚Äî –ø—Ä–∏ `activeEntries.length > 0` –º–∞—Å—Å–∏–≤ –Ω–µ –ø—É—Å—Ç–æ–π, –Ω–æ —è–≤–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Ç.  
**–†–∏—Å–∫:** –ù–∏–∑–∫–∏–π.  
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å `if (!activeEntry) return;` –ø–æ—Å–ª–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è –¥–ª—è –∑–∞—â–∏—Ç—ã.

---

### 5. –ú–Ω–æ–≥–æ `.catch(() => {})` –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
**–§–∞–π–ª—ã:** `src/App.tsx`, `src/store/useTrackerStore.ts`, `src/components/Timer.tsx`  
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—à–∏–±–∫–∏ –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞—é—Ç—Å—è, –æ—Ç–ª–∞–¥–∫–∞ —É—Å–ª–æ–∂–Ω—è–µ—Ç—Å—è.  
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ `.catch((e) => logger.debug('...', e))` –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤.

---

## üü¢ –ù–∏–∑–∫–∏–µ / –£–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ

### 6. `loadProjects` –ø—Ä–∏ –æ—à–∏–±–∫–µ
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–µ `projects` –Ω–µ –æ—á–∏—â–∞—é—Ç—Å—è, –æ—Å—Ç–∞—é—Ç—Å—è –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ.

### 7. Sync `mark_task_sent` –≤ Rust
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ï—Å—Ç—å retry —Å exponential backoff (3 –ø–æ–ø—ã—Ç–∫–∏).

### 8. –ú–∞—Å—Å–∏–≤ `activeEntries` –≤ `startTracking`
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω try/catch –¥–ª—è –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞.
