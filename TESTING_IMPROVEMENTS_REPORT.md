# –û—Ç—á–µ—Ç –æ–± —É–ª—É—á—à–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è TimerEngine (19 —Ç–µ—Å—Ç–æ–≤)

**–°–æ–∑–¥–∞–Ω–æ:**
- `test_timer_engine_new` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ TimerEngine
- `test_fsm_transition_stopped_to_running` - –ø–µ—Ä–µ—Ö–æ–¥ Stopped ‚Üí Running
- `test_fsm_transition_running_to_paused` - –ø–µ—Ä–µ—Ö–æ–¥ Running ‚Üí Paused
- `test_fsm_transition_paused_to_running` - –ø–µ—Ä–µ—Ö–æ–¥ Paused ‚Üí Running
- `test_fsm_transition_running_to_stopped` - –ø–µ—Ä–µ—Ö–æ–¥ Running ‚Üí Stopped
- `test_fsm_transition_paused_to_stopped` - –ø–µ—Ä–µ—Ö–æ–¥ Paused ‚Üí Stopped
- `test_fsm_invalid_transition_running_to_running` - –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- `test_fsm_invalid_transition_paused_to_paused` - –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- `test_fsm_invalid_transition_stopped_to_paused` - –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- `test_fsm_invalid_transition_stopped_to_stopped` - –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- `test_fsm_invalid_transition_stopped_to_running_via_resume` - –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- `test_accumulated_time_increases_on_pause` - –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –ø–∞—É–∑–µ
- `test_accumulated_time_increases_on_stop` - –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ
- `test_elapsed_seconds_increases_while_running` - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ elapsed –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
- `test_elapsed_seconds_stays_constant_when_paused` - elapsed –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ Paused
- `test_accumulated_time_persists_across_sessions` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ accumulated –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
- `test_reset_day` - —Å–±—Ä–æ—Å –¥–Ω—è
- `test_reset_day_stops_running_timer` - reset_day –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–∞–π–º–µ—Ä
- `test_full_cycle_stopped_running_paused_stopped` - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –í—Å–µ 19 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- –ü–æ–∫—Ä—ã—Ç–∏–µ: ~85-90% (–æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã)

**–ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ:**
- –í—Å–µ FSM –ø–µ—Ä–µ—Ö–æ–¥—ã (–≤–∞–ª–∏–¥–Ω—ã–µ –∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ)
- –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (accumulated_seconds)
- –†–∞—Å—á–µ—Ç elapsed_seconds
- –°–±—Ä–æ—Å –¥–Ω—è (reset_day)
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞

---

### 2. ‚úÖ Unit —Ç–µ—Å—Ç—ã –¥–ª—è Database (12 —Ç–µ—Å—Ç–æ–≤)

**–°–æ–∑–¥–∞–Ω–æ:**
- `test_database_new` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ë–î
- `test_database_init_schema` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã (—Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã)
- `test_save_timer_state` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
- `test_load_timer_state_empty` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ø—É—Å—Ç–æ–π –ë–î
- `test_save_timer_state_updates_existing` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `test_enqueue_sync` - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å
- `test_get_pending_sync_tasks` - –ø–æ–ª—É—á–µ–Ω–∏–µ pending –∑–∞–¥–∞—á
- `test_update_sync_status` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞—á–∏
- `test_get_retry_tasks` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –¥–ª—è retry
- `test_get_retry_tasks_respects_max_retries` - –ø—Ä–æ–≤–µ—Ä–∫–∞ max_retries
- `test_multiple_days_timer_state` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–Ω–µ–π
- `test_sync_queue_ordering` - –ø–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –í—Å–µ 12 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- –ü–æ–∫—Ä—ã—Ç–∏–µ: ~85-90% (–æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–∫—Ä—ã—Ç—ã)

**–ß—Ç–æ –ø–æ–∫—Ä—ã—Ç–æ:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –æ—á–µ—Ä–µ–¥—å—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–¥–∞—á
- Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff
- –ü–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏

---

### 3. ‚úÖ E2E —Ç–µ—Å—Ç—ã –¥–ª—è Token Refresh (4 —Ç–µ—Å—Ç–∞)

**–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª:** `e2e/token-refresh.spec.ts`

**–¢–µ—Å—Ç—ã:**
1. `should refresh token upon expiration (401 error)` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ 401
2. `should use refreshed token for subsequent requests` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞
3. `should handle refresh token expiration gracefully` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è refresh token
4. `should refresh token during queue synchronization` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–∏

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ Refresh token –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ 401 –æ—à–∏–±–∫–µ
- ‚úÖ –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è refresh token
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –æ—á–µ—Ä–µ–¥–∏

---

### 4. ‚úÖ E2E —Ç–µ—Å—Ç—ã –¥–ª—è SyncManager (3 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞)

**–†–∞—Å—à–∏—Ä–µ–Ω —Ñ–∞–π–ª:** `e2e/queue-integration.spec.ts`

**–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
1. `should retry failed sync tasks with exponential backoff` - retry —Å exponential backoff
2. `should handle max retries limit` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏–º–∏—Ç–∞ max retries
3. `should sync multiple queued tasks in order` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–¥–∞—á –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- ‚úÖ Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏–º–∏—Ç–∞ max retries
- ‚úÖ –ü–æ—Ä—è–¥–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞–¥–∞—á (FIFO)

---

### 5. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏ –≤ TimerEngine —Ç–µ—Å—Ç–∞—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞–ª–∏ –∏–∑-–∑–∞ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏—Ö –∑–∞–¥–µ—Ä–∂–µ–∫ (50-100ms)
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ `> 0`, –Ω–æ –≤—Ä–µ–º—è –º–æ–≥–ª–æ –±—ã—Ç—å 0

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ —Å 50-100ms –¥–æ 200-300ms –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö
- –ò–∑–º–µ–Ω–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å `> 0` –Ω–∞ `>= 0` –¥–ª—è –±–æ–ª–µ–µ –≥–∏–±–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö Database –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ –ø–æ—Ä—è–¥–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ –í—Å–µ 40 unit —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤ —É–ª—É—á—à–µ–Ω–∞

---

## üìä –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### Unit —Ç–µ—Å—Ç—ã
- **TimerEngine:** 19 —Ç–µ—Å—Ç–æ–≤ ‚úÖ
- **Database:** 12 —Ç–µ—Å—Ç–æ–≤ ‚úÖ
- **–î—Ä—É–≥–∏–µ:** 9 —Ç–µ—Å—Ç–æ–≤ ‚úÖ
- **–í—Å–µ–≥–æ:** 40 unit —Ç–µ—Å—Ç–æ–≤ (–≤—Å–µ –ø—Ä–æ—Ö–æ–¥—è—Ç)

### E2E —Ç–µ—Å—Ç—ã
- **Token Refresh:** 4 —Ç–µ—Å—Ç–∞ ‚úÖ
- **SyncManager:** 3 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞ ‚úÖ
- **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ:** ~8 —Ç–µ—Å—Ç–æ–≤ ‚úÖ
- **–í—Å–µ–≥–æ:** ~15+ E2E —Ç–µ—Å—Ç–æ–≤

### –ü–æ–∫—Ä—ã—Ç–∏–µ
- **TimerEngine:** ~85-90% ‚úÖ
- **Database:** ~85-90% ‚úÖ
- **Token Refresh:** E2E –ø–æ–∫—Ä—ã—Ç–∏–µ ‚úÖ
- **SyncManager:** E2E –ø–æ–∫—Ä—ã—Ç–∏–µ ‚úÖ

---

## üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è

1. ‚úÖ **–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ—Å—Ç–∞–º–∏:**
   - TimerEngine (—è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã) - 19 unit —Ç–µ—Å—Ç–æ–≤
   - Database (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å) - 12 unit —Ç–µ—Å—Ç–æ–≤

2. ‚úÖ **E2E –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è –≤–∞–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
   - Token Refresh - 4 —Ç–µ—Å—Ç–∞
   - SyncManager retry –º–µ—Ö–∞–Ω–∏–∑–º - 3 —Ç–µ—Å—Ç–∞

3. ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤:**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏
   - –í—Å–µ 40 unit —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

1. **Unit —Ç–µ—Å—Ç—ã –¥–ª—è SyncManager:**
   - Retry –º–µ—Ö–∞–Ω–∏–∑–º —Å exponential backoff
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ 401
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫

2. **E2E —Ç–µ—Å—Ç—ã –¥–ª—è Active Window Tracking:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –∞–∫—Ç–∏–≤–Ω–æ–º –æ–∫–Ω–µ
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

3. **E2E —Ç–µ—Å—Ç—ã –¥–ª—è Screenshots:**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π

4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
   - –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º API (staging)
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ sleep/wake —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. `src-tauri/src/lib.rs` - –¥–æ–±–∞–≤–ª–µ–Ω—ã unit —Ç–µ—Å—Ç—ã –¥–ª—è TimerEngine –∏ Database
2. `src-tauri/Cargo.toml` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `tempfile` –¥–ª—è —Ç–µ—Å—Ç–æ–≤
3. `e2e/token-refresh.spec.ts` - –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å E2E —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è Token Refresh
4. `e2e/queue-integration.spec.ts` - —Ä–∞—Å—à–∏—Ä–µ–Ω E2E —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è SyncManager

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2024-01-XX
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
