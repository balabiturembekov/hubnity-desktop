# –ü–†–û–í–ï–†–ö–ê –†–ï–ê–õ–¨–ù–û–ì–û –í–´–ü–û–õ–ù–ï–ù–ò–Ø –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò

## Staff Backend Engineer / Production Incident Investigator Report

**–î–∞—Ç–∞:** 2025-01-12  
**–ú–µ—Ç–æ–¥:** Execution path analysis (–±–µ–∑ –¥–æ–≤–µ—Ä–∏—è –∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º/—Ç–µ—Å—Ç–∞–º)

---

## üîç –®–ê–ì 1: –¢–û–ß–ö–ò –ó–ê–ü–£–°–ö–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò

### Entrypoint 1: Background Job (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)

**–§–∞–π–ª:** `src-tauri/src/lib.rs:5578-5614`

**–ö–æ–¥:**

```rust
std::thread::spawn(move || {
    let rt = tokio::runtime::Runtime::new().unwrap_or_else(|e| {
        eprintln!("[SYNC] CRITICAL: Failed to create Tokio runtime...");
        std::process::exit(1);
    });
    rt.block_on(async {
        tokio::time::sleep(tokio::time::Duration::from_secs(10)).await;
        info!("[SYNC] Starting background sync task");
        let mut interval = tokio::time::interval(Duration::from_secs(60));
        loop {
            interval.tick().await;
            match sync_manager_bg.sync_queue(5).await {
                Ok(count) => {
                    if count > 0 {
                        info!("[SYNC] Synced {} tasks", count);
                    }
                }
                Err(e) => { /* –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ */ }
            }
        }
    });
});
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:** –í `setup()` hook –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (line 5578)
- ‚úÖ **–£—Å–ª–æ–≤–∏–µ:** –í—Å–µ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–Ω–µ—Ç —É—Å–ª–æ–≤–∏–π)
- ‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä:** –ö–∞–∂–¥—ã–µ 60 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ 10-—Å–µ–∫—É–Ω–¥–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `Runtime::new()` –ø–∞–¥–∞–µ—Ç ‚Üí `process::exit(1)` ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
- ‚úÖ **–õ–æ–≥ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:** `info!("[SYNC] Starting background sync task")` (line 5593)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

### Entrypoint 2: Tauri Command `sync_queue_now`

**–§–∞–π–ª:** `src-tauri/src/lib.rs:5319-5321`

**–ö–æ–¥:**

```rust
#[tauri::command]
async fn sync_queue_now(sync_manager: State<'_, SyncManager>) -> Result<usize, String> {
    sync_manager.sync_queue(5).await
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:** –í `invoke_handler` (line 5625)
- ‚ùå **–í—ã–∑–æ–≤—ã –∏–∑ frontend:** –ù–ï –ù–ê–ô–î–ï–ù–û –≤ `src/`
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ö–æ–º–∞–Ω–¥–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ UI
- ‚úÖ **E2E —Ç–µ—Å—Ç—ã:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `e2e/token-refresh.spec.ts:585` (—á–µ—Ä–µ–∑ `__TAURI_INTERNALS__`)

**–í–µ—Ä–¥–∏–∫—Ç:** üü° **–ß–ê–°–¢–ò–ß–ù–û –†–ê–ë–û–¢–ê–ï–¢** ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production UI

---

### Entrypoint 3: `retry_failed_tasks()`

**–§–∞–π–ª:** `src-tauri/src/lib.rs:5415-5429`

**–ö–æ–¥:**

```rust
#[tauri::command]
async fn retry_failed_tasks(...) -> Result<i32, String> {
    // ...
    let _ = sync_manager.sync_queue(5).await; // line 5428
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:** –í `invoke_handler` (line 5629)
- ‚ùå **–í—ã–∑–æ–≤—ã –∏–∑ frontend:** –ù–ï –ù–ê–ô–î–ï–ù–û –≤ `src/`
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ö–æ–º–∞–Ω–¥–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI
- ‚úÖ **–õ–æ–≥:** `info!("[SYNC] Reset {} failed tasks back to pending", count)` (line 5425)

**–í–µ—Ä–¥–∏–∫—Ç:** üü° **–ß–ê–°–¢–ò–ß–ù–û –†–ê–ë–û–¢–ê–ï–¢** ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production UI

---

### Entrypoint 4: Enqueue –∏–∑ UI –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª:** `src/store/useTrackerStore.ts`

**–í—ã–∑–æ–≤—ã `enqueue_time_entry`:**

- Line 417: `startTracking()` ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞
- Line 563: `pauseTracking()` ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞
- Line 728: `resumeTracking()` ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞
- Line 851: `stopTracking()` ‚Äî –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä:** –ü—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞
- ‚úÖ **–£—Å–ª–æ–≤–∏–µ:** –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ API –≤—ã–∑–æ–≤ —É—Å–ø–µ—à–µ–Ω
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ API –≤—ã–∑–æ–≤ —É—Å–ø–µ—à–µ–Ω, –Ω–æ `enqueue_time_entry` –ø–∞–¥–∞–µ—Ç ‚Üí –∑–∞–¥–∞—á–∞ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ù–µ—Ç –ø—Ä—è–º–æ–≥–æ –ª–æ–≥–∞, –Ω–æ –µ—Å—Ç—å Rust-side –ª–æ–≥–∏ –≤ `enqueue_sync()`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞

---

## üîç –®–ê–ì 2: SQLITE ‚Üí SYNC –¶–ï–ü–û–ß–ö–ê

### –¶–µ–ø–æ—á–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

#### 1. `enqueue_sync()` ‚Üí SQLite

**–§–∞–π–ª:** `src-tauri/src/lib.rs:2625-2712`

**–ö–æ–¥:**

```rust
fn enqueue_sync(&self, entity_type: &str, payload: &str) -> SqliteResult<i64> {
    let conn = self.lock_conn()?;
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ ...
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –æ—á–µ—Ä–µ–¥–∏ ...
    conn.execute(
        "INSERT INTO sync_queue (entity_type, payload, status, created_at, priority)
         VALUES (?1, ?2, 'pending', ?3, ?4)",
        params![entity_type, payload, now, priority_value],
    )?;
    Ok(conn.last_insert_rowid())
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π:** –ù–µ—Ç `await`, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è SQLite
- ‚úÖ **Early return:** –¢–æ–ª—å–∫–æ –ø—Ä–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞—Ö (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ID)
- ‚úÖ **–û—à–∏–±–∫–∏:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `SqliteResult`, –Ω–µ silent
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `lock_conn()` –ø–∞–¥–∞–µ—Ç ‚Üí –∑–∞–¥–∞—á–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è, –Ω–æ –æ—à–∏–±–∫–∞ –≤–µ—Ä–Ω–µ—Ç—Å—è

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ SQLite

---

#### 2. `get_retry_tasks()` ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á

**–§–∞–π–ª:** `src-tauri/src/lib.rs:2925-2967`

**–ö–æ–¥:**

```rust
fn get_retry_tasks(&self, max_retries: i32, batch_size: i32) -> SqliteResult<Vec<...>> {
    let conn = self.lock_conn()?;
    let now = Utc::now().timestamp();
    let mut stmt = conn.prepare(
        "SELECT id, entity_type, payload, retry_count FROM sync_queue
         WHERE status = 'pending' AND retry_count < ?1
         AND (last_retry_at IS NULL OR
              last_retry_at + CASE ... END <= ?2)
         ORDER BY priority ASC, created_at ASC
         LIMIT ?3",
    )?;
    // ...
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è:** `retry_count < max_retries` ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **Exponential backoff:** `last_retry_at + delay <= now` ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:** `ORDER BY priority ASC, created_at ASC` ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **Batch size:** `LIMIT ?3` ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `batch_size = 0` ‚Üí –≤–µ—Ä–Ω–µ—Ç –ø—É—Å—Ç–æ–π Vec, –Ω–æ —ç—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–¥–∞—á–∏

---

#### 3. `run_sync_internal()` ‚Üí –û–±—Ä–∞–±–æ—Ç–∫–∞

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3401-3577`

**Early returns:**

```rust
// Line 3404-3407: –ù–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤
if self.auth_manager.get_access_token().await.is_err() {
    warn!("[SYNC] Skipping sync: access token not set...");
    return Ok(0);
}

// Line 3415-3417: –ù–µ—Ç pending –∑–∞–¥–∞—á
if pending_count == 0 {
    return Ok(0);
}

// Line 3450-3452: –ü—É—Å—Ç–æ–π batch –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
if tasks.is_empty() {
    return Ok(0);
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ early returns –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ **–ù–µ—Ç silent exits:** –í—Å–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç `Ok(0)` —Å –ª–æ–≥–∞–º–∏
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `get_pending_count()` –ø–∞–¥–∞–µ—Ç ‚Üí –≤–µ—Ä–Ω–µ—Ç `Err`, –Ω–µ silent
- ‚úÖ **–õ–æ–≥ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:** `info!("[SYNC] Starting sync: {} pending tasks...")` (line 3439)

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî –Ω–µ—Ç silent failures, –≤—Å–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è

---

#### 4. `sync_task()` ‚Üí HTTP –≤—ã–∑–æ–≤

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3231-3397`

**HTTP –∑–∞–ø—Ä–æ—Å:**

```rust
let response_result = if entity_type.starts_with("time_entry_") {
    // ... –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ URL –∏ –º–µ—Ç–æ–¥–∞ ...
    method
        .header("Authorization", format!("Bearer {}", access_token))
        .json(&request_payload)
        .send()
        .await  // ‚Üê –§–ê–ö–¢–ò–ß–ï–°–ö–ò–ô HTTP –ó–ê–ü–†–û–°
} else if entity_type == "screenshot" {
    client
        .post(&url)
        .header("Authorization", format!("Bearer {}", access_token))
        .json(&screenshot_payload)
        .send()
        .await  // ‚Üê –§–ê–ö–¢–ò–ß–ï–°–ö–ò–ô HTTP –ó–ê–ü–†–û–°
}
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞:**

```rust
match response_result {
    Ok(response) => {
        if status.is_success() {
            return Ok(true);  // ‚Üê –£–°–ü–ï–•
        } else {
            return Err(error_msg);  // ‚Üê –û–®–ò–ë–ö–ê –°–ï–†–í–ï–†–ê
        }
    }
    Err(e) => {
        return Err(format!("Network error: {}", e));  // ‚Üê –û–®–ò–ë–ö–ê –°–ï–¢–ò
    }
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **HTTP –∑–∞–ø—Ä–æ—Å:** –†–µ–∞–ª—å–Ω—ã–π `reqwest::Client::send().await` (line 3302, 3323)
- ‚úÖ **–¢–∞–π–º–∞—É—Ç:** 120 —Å–µ–∫—É–Ω–¥ (line 3241)
- ‚úÖ **401 –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh token (line 3334-3374)
- ‚úÖ **–û—à–∏–±–∫–∏:** –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–∞–∫ `Err`, –Ω–µ silent
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `send().await` –∑–∞–≤–∏—Å–Ω–µ—Ç ‚Üí —Ç–∞–π–º–∞—É—Ç —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ 120 —Å–µ–∫

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

---

#### 5. `mark_task_sent()` ‚Üí –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

**–§–∞–π–ª:** `src-tauri/src/lib.rs:2858-2867`

**–ö–æ–¥:**

```rust
fn mark_task_sent(&self, id: i64) -> SqliteResult<()> {
    let conn = self.lock_conn()?;
    conn.execute(
        "UPDATE sync_queue SET status = 'sent' WHERE id = ?1",
        params![id],
    )?;
    Ok(())
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è:** –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ `Ok(true)` –∏–∑ `sync_task()` (line 3475)
- ‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π:** –ù–µ—Ç `await`, –Ω–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è SQLite
- ‚úÖ **–û—à–∏–±–∫–∏:** –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `SqliteResult`, –Ω–µ silent
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `mark_task_sent()` –ø–∞–¥–∞–µ—Ç ‚Üí –∑–∞–¥–∞—á–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è `pending`, –Ω–æ –æ—à–∏–±–∫–∞ –≤–µ—Ä–Ω–µ—Ç—Å—è

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–∞

---

## üîç –®–ê–ì 3: SINGLE-FLIGHT –ê–ù–ê–õ–ò–ó

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3582-3586`

**–ö–æ–¥:**

```rust
async fn sync_queue(&self, max_retries: i32) -> Result<usize, String> {
    let _lock = self.sync_lock.lock().await;  // ‚Üê –ë–õ–û–ö–ò–†–û–í–ö–ê
    self.run_sync_internal(max_retries).await
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **Lock –±–µ—Ä–µ—Ç—Å—è:** –°—Ä–∞–∑—É –≤ –Ω–∞—á–∞–ª–µ –º–µ—Ç–æ–¥–∞, –î–û `run_sync_internal()`
- ‚úÖ **–ù–µ—Ç await –î–û lock:** Lock –±–µ—Ä–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º –¥–µ–π—Å—Ç–≤–∏–µ–º
- ‚úÖ **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ scope (RAII)
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ï—Å–ª–∏ `run_sync_internal()` –∑–∞–≤–∏—Å–Ω–µ—Ç ‚Üí lock –Ω–µ –æ—Å–≤–æ–±–æ–¥–∏—Ç—Å—è, –Ω–æ —ç—Ç–æ –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –†–ò–°–ö:** –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è lock ‚Äî –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π sync –∑–∞–≤–∏—Å, –Ω–æ–≤—ã–π –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –≤–µ—á–Ω–æ

**–°—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–∏—Å–∞–Ω–∏—è:**

1. Sync —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª, –≤–∑—è–ª lock
2. `run_sync_internal()` –∑–∞–≤–∏—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP –∑–∞–ø—Ä–æ—Å –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–∞)
3. Lock –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
4. –°–ª–µ–¥—É—é—â–∏–π sync –∂–¥–µ—Ç lock –≤–µ—á–Ω–æ
5. –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å

**–í–µ—Ä–¥–∏–∫—Ç:** üü° **–†–ê–ë–û–¢–ê–ï–¢, –ù–û –° –†–ò–°–ö–û–ú** ‚Äî –Ω–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è lock

---

## üîç –®–ê–ì 4: HTTP –§–ê–ö–¢–ò–ß–ï–°–ö–ê–Ø –û–¢–ü–†–ê–í–ö–ê

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3298-3395`

**–†–µ–∞–ª—å–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å:**

```rust
method
    .header("Content-Type", "application/json")
    .header("Authorization", format!("Bearer {}", access_token))
    .json(&request_payload)
    .send()  // ‚Üê –§–ê–ö–¢–ò–ß–ï–°–ö–ò–ô HTTP –ó–ê–ü–†–û–°
    .await
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

```rust
match response_result {
    Ok(response) => {
        if status.is_success() {
            return Ok(true);  // ‚Üí mark_task_sent() –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
        } else {
            return Err(error_msg);  // ‚Üí retry_count++ –≤ run_sync_internal
        }
    }
    Err(e) => {
        return Err(format!("Network error: {}", e));  // ‚Üí retry_count++ –≤ run_sync_internal
    }
}
```

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **HTTP –∑–∞–ø—Ä–æ—Å:** –†–µ–∞–ª—å–Ω—ã–π `reqwest::Client::send().await`
- ‚úÖ **–¢–∞–π–º–∞—É—Ç:** 120 —Å–µ–∫—É–Ω–¥ (line 3241)
- ‚úÖ **401 –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π refresh token (line 3334-3374)
- ‚úÖ **–û—à–∏–±–∫–∏:** –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è, –Ω–µ silent
- ‚úÖ **Retry:** –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ `run_sync_internal()` ‚Üí `retry_count++`

**–í–µ—Ä–¥–∏–∫—Ç:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

---

## üîç –®–ê–ì 5: –õ–û–ì–ò –ö–ê–ö –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–û

### –õ–æ–≥–∏ –≤ execution path:

1. **–î–û –Ω–∞—á–∞–ª–∞ sync:**

   - ‚úÖ `info!("[SYNC] Starting background sync task")` (line 5593)
   - ‚úÖ `info!("[SYNC] Starting sync: {} pending tasks...")` (line 3439)

2. **–ü–û–°–õ–ï —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏:**

   - ‚úÖ `info!("[SYNC] Sync completed: Synced: {} tasks...")` (line 3574)
   - ‚úÖ `info!("[SYNC] Synced {} tasks")` (line 5600) ‚Äî —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ count > 0

3. **–ü—Ä–∏ skip / empty batch:**

   - ‚úÖ `warn!("[SYNC] Skipping sync: access token not set...")` (line 3405)
   - ‚ö†Ô∏è **–ù–ï–¢ –õ–û–ì–ê** –ø—Ä–∏ `pending_count == 0` (line 3415-3417) ‚Äî silent return
   - ‚ö†Ô∏è **–ù–ï–¢ –õ–û–ì–ê** –ø—Ä–∏ `tasks.is_empty()` (line 3450-3452) ‚Äî silent return

4. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö:**
   - ‚úÖ `warn!("[SYNC] Task {} failed after {} retries...")` (line 3497, 3528)
   - ‚úÖ `info!("[SYNC] Task {} will retry later...")` (line 3507, 3537)
   - ‚úÖ `error!("[SYNC] Background sync error: {}")` (line 5608)

**–ê–Ω–∞–ª–∏–∑:**

- ‚úÖ **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç—Ç–∞–ø—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:** Start, success, errors
- ‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ª–æ–≥–æ–≤ –ø—Ä–∏ empty batch (–º–æ–∂–µ—Ç –±—ã—Ç—å silent skip)
- ‚úÖ **–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã:** –õ–æ–≥–∏ `[SYNC] Starting sync` –∏ `[SYNC] Sync completed` –¥–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

**–í–µ—Ä–¥–∏–∫—Ç:** üü° **–ß–ê–°–¢–ò–ß–ù–û** ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –µ—Å—Ç—å silent returns

---

## üîç –®–ê–ì 6: PRODUCTION VERDICT

### Findings:

**‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:**

1. Background job –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. `enqueue_sync()` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏ –≤ SQLite
3. `get_retry_tasks()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∑–∞–¥–∞—á–∏
4. `sync_task()` –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π HTTP –∑–∞–ø—Ä–æ—Å
5. `mark_task_sent()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–∞
6. Single-flight –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (lock –±–µ—Ä–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
7. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. `sync_queue_now()` –¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI
2. `retry_failed_tasks()` –¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI
3. –ù–µ—Ç –ª–æ–≥–æ–≤ –ø—Ä–∏ empty batch (silent return)

**üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏:**

1. **–ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è `sync_lock`** (line 3584)

   - –ï—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π sync –∑–∞–≤–∏—Å ‚Üí –Ω–æ–≤—ã–π –±—É–¥–µ—Ç –∂–¥–∞—Ç—å –≤–µ—á–Ω–æ
   - –§–æ–Ω–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - **–§–∞–π–ª:** `src-tauri/src/lib.rs:3584`
   - **–°—Ç—Ä–æ–∫–∞:** 3584
   - **–£—Å–ª–æ–≤–∏–µ:** `run_sync_internal()` –∑–∞–≤–∏—Å–∞–µ—Ç –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–∞

2. **Silent returns –ø—Ä–∏ empty batch** (line 3415-3417, 3450-3452)
   - –ù–µ—Ç –ª–æ–≥–æ–≤ –ø—Ä–∏ `pending_count == 0` –∏–ª–∏ `tasks.is_empty()`
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ sync –∑–∞–ø—É—Å–∫–∞–ª—Å—è, –Ω–æ –Ω–µ –Ω–∞—à–µ–ª –∑–∞–¥–∞—á
   - **–§–∞–π–ª:** `src-tauri/src/lib.rs:3415-3417, 3450-3452`

---

## üéØ HARD VERDICT

### üü¢ **SYNC –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø** (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

**–ü—Ä–∏—á–∏–Ω—ã:**

1. ‚úÖ Background job –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ
2. ‚úÖ –¶–µ–ø–æ—á–∫–∞ SQLite ‚Üí HTTP ‚Üí mark_task_sent —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç—Ç–∞–ø–æ–≤ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç
4. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ –ø—Ä–∏ empty batch
5. ‚úÖ **–ò–°–ü–†–ê–í–õ–ï–ù–û:** –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–∞—É—Ç –¥–ª—è lock (300 —Å–µ–∫)

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã:**

- ‚úÖ –õ–æ–≥–∏ `[SYNC] Starting sync` –∏ `[SYNC] Sync completed` –¥–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
- ‚úÖ –õ–æ–≥–∏ `[SYNC] Synced {} tasks` –¥–æ–∫–∞–∑—ã–≤–∞—é—Ç —É—Å–ø–µ—à–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
- ‚ö†Ô∏è –ù–µ—Ç –ª–æ–≥–æ–≤ –ø—Ä–∏ empty batch ‚Üí silent skip

**–†–∏—Å–∫–∏:**

- üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô:** –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –¥–ª—è `sync_lock` ‚Üí –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –Ω–∞–≤—Å–µ–≥–¥–∞
- üü° **–°–†–ï–î–ù–ò–ô:** Silent returns –ø—Ä–∏ empty batch ‚Üí –Ω–µ—Ç –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## üîß MINIMAL FIX

### Fix 1: –¢–∞–π–º–∞—É—Ç –¥–ª—è sync_lock (–ö–†–ò–¢–ò–ß–ù–û)

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3582-3586`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```rust
async fn sync_queue(&self, max_retries: i32) -> Result<usize, String> {
    let _lock = self.sync_lock.lock().await;
    self.run_sync_internal(max_retries).await
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```rust
use tokio::time::{timeout, Duration};

async fn sync_queue(&self, max_retries: i32) -> Result<usize, String> {
    match timeout(Duration::from_secs(300), self.sync_lock.lock()).await {
        Ok(lock) => {
            let _lock = lock;
            self.run_sync_internal(max_retries).await
        }
        Err(_) => {
            error!("[SYNC] CRITICAL: Sync lock timeout - previous sync may be stuck");
            Err("Sync lock timeout: previous sync may be stuck".to_string())
        }
    }
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **CRITICAL**

---

### Fix 2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ empty batch (–°–†–ï–î–ù–ò–ô)

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3415-3417, 3450-3452`

**–¢–µ–∫—É—â–∏–π –∫–æ–¥:**

```rust
if pending_count == 0 {
    return Ok(0);  // ‚Üê –ù–ï–¢ –õ–û–ì–ê
}

// ...

if tasks.is_empty() {
    return Ok(0);  // ‚Üê –ù–ï–¢ –õ–û–ì–ê
}
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

```rust
if pending_count == 0 {
    debug!("[SYNC] No pending tasks, skipping sync");
    return Ok(0);
}

// ...

if tasks.is_empty() {
    debug!("[SYNC] No tasks ready for retry (exponential backoff), skipping batch");
    return Ok(0);
}
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° **MEDIUM**

---

## üìä –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¶–ï–ù–ö–ê

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç        | –°—Ç–∞—Ç—É—Å      | –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ                             |
| ---------------- | ----------- | ------------------------------------------ |
| Background job   | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –õ–æ–≥ `[SYNC] Starting background sync task` |
| Enqueue ‚Üí SQLite | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ö–æ–¥ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ                 |
| get_retry_tasks  | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | SQL –∑–∞–ø—Ä–æ—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π                      |
| HTTP –∑–∞–ø—Ä–æ—Å      | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –†–µ–∞–ª—å–Ω—ã–π `reqwest::Client::send()`         |
| mark_task_sent   | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `Ok(true)`                |
| Single-flight    | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –¢–∞–π–º–∞—É—Ç –¥–ª—è lock (300 —Å–µ–∫)                 |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ      | ‚úÖ –ü–æ–ª–Ω–æ–µ   | –õ–æ–≥–∏ –ø—Ä–∏ empty batch –¥–æ–±–∞–≤–ª–µ–Ω—ã             |

**–û–±—â–∏–π –≤–µ—Ä–¥–∏–∫—Ç:** üü¢ **SYNC –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø** (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

**–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

- ‚úÖ **Fix 1 (CRITICAL):** –¢–∞–π–º–∞—É—Ç –¥–ª—è sync_lock –ø—Ä–∏–º–µ–Ω–µ–Ω (300 —Å–µ–∫)
- ‚úÖ **Fix 2 (MEDIUM):** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ empty batch –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production deployment.

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:** Staff Backend Engineer / Production Incident Investigator  
**–î–∞—Ç–∞:** 2025-01-12  
**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-01-12 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)  
**–ú–µ—Ç–æ–¥:** Execution path analysis (—Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç—ã –∏–∑ –∫–æ–¥–∞)

---

## ‚úÖ –ü–†–ò–ú–ï–ù–ï–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### Fix 1: –¢–∞–π–º–∞—É—Ç –¥–ª—è sync_lock (CRITICAL) ‚úÖ

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3586-3607`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- –î–æ–±–∞–≤–ª–µ–Ω `tokio::time::timeout(Duration::from_secs(300), ...)` –¥–ª—è lock
- –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `Err`
- –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ sync

### Fix 2: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ empty batch (MEDIUM) ‚úÖ

**–§–∞–π–ª:** `src-tauri/src/lib.rs:3416, 3452-3454`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**

- –î–æ–±–∞–≤–ª–µ–Ω `debug!()` –ª–æ–≥ –ø—Ä–∏ `pending_count == 0`
- –î–æ–±–∞–≤–ª–µ–Ω `debug!()` –ª–æ–≥ –ø—Ä–∏ `tasks.is_empty()`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `debug` –≤ `use tracing::`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–µ–ø–µ—Ä—å –≤—Å–µ execution paths –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–µ—Ç silent returns.
