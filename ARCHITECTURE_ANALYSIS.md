# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ Hubnity Time Tracker

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-06  
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** Senior Software Architect + System Engineer  
**–£—Ä–æ–≤–µ–Ω—å –∑—Ä–µ–ª–æ—Å—Ç–∏:** **MVP+ (–±–ª–∏–∑–∫–æ –∫ Production, –Ω–æ —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏)**

---

## üìã –ö–†–ê–¢–ö–û–ï SUMMARY (Executive Summary)

### ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ö–æ—Ä–æ—à–æ:

1. **–ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Tauri 2.0** - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ Rust backend / React frontend
2. **State management** - Zustand –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
3. **Idle detection** - —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ mouse position (macOS)
4. **Token refresh** - —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å queue –¥–ª—è concurrent requests
5. **Daily timer reset** - –ª–æ–≥–∏–∫–∞ –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞ –¥–µ–Ω—å —Ä–∞–±–æ—Ç–∞–µ—Ç
6. **E2E —Ç–µ—Å—Ç—ã** - 9 —Ç–µ—Å—Ç–æ–≤ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ù–ï–¢ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞** - —Ç–æ–ª—å–∫–æ localStorage, –Ω–µ—Ç SQLite/IndexedDB
2. **–ù–ï–¢ offline queue** - —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ URL activities —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏
3. **–ù–ï–¢ –æ–±—Ä–∞–±–æ—Ç–∫–∏ sleep/wake** - —Ç–∞–π–º–µ—Ä –º–æ–∂–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ sleep
4. **Active window tracking –æ—Ç–∫–ª—é—á–µ–Ω** - –∏–∑-–∑–∞ Objective-C exceptions
5. **–ù–ï–¢ –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–¥–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `Date.now()` (–º–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å)

### ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ—Ç —Å—Ç—Ä–æ–≥–æ–π state machine** - –≤–æ–∑–º–æ–∂–Ω—ã race conditions
2. **–°–∫—Ä–∏–Ω—à–æ—Ç—ã –±–µ–∑ –æ—á–µ—Ä–µ–¥–∏** - —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
3. **–ù–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è** - —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ base64 –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
4. **–ù–µ—Ç retry/backoff** - —Ç–æ–ª—å–∫–æ –¥–ª—è token refresh, –Ω–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## 1. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### 1.1 –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
hubnity/
‚îú‚îÄ‚îÄ src-tauri/          # Rust backend (Tauri 2.0)
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ lib.rs      # –í–°–ï –∫–æ–º–∞–Ω–¥—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ (824 —Å—Ç—Ä–æ–∫–∏)
‚îÇ       ‚îî‚îÄ‚îÄ main.rs     # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ src/                # React 19 + TypeScript frontend
‚îÇ   ‚îú‚îÄ‚îÄ store/          # Zustand stores (useTrackerStore, useAuthStore)
‚îÇ   ‚îú‚îÄ‚îÄ components/     # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ lib/            # API client (Axios)
‚îÇ   ‚îî‚îÄ‚îÄ App.tsx         # –ì–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (863 —Å—Ç—Ä–æ–∫–∏)
```

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–ú–æ–Ω–æ–ª–∏—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

- –í—Å–µ Rust –∫–æ–º–∞–Ω–¥—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ (lib.rs) - –ø–ª–æ—Ö–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- App.tsx —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (863 —Å—Ç—Ä–æ–∫–∏) - –Ω—É–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏
- –ù–µ—Ç —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞ services/engines - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–º–µ—à–∞–Ω–∞ —Å UI

### 1.2 –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è UI ‚Üî Rust

**–ú–µ—Ö–∞–Ω–∏–∑–º:** Tauri `invoke()` + Events

**Rust –∫–æ–º–∞–Ω–¥—ã (19 —à—Ç—É–∫):**

- `start_activity_monitoring` / `stop_activity_monitoring`
- `take_screenshot` / `upload_screenshot`
- `get_active_window_info` (‚ö†Ô∏è –û–¢–ö–õ–Æ–ß–ï–ù)
- `show_idle_window` / `hide_idle_window`
- `update_idle_state` / `request_idle_state`
- –ò –¥—Ä—É–≥–∏–µ...

**Events:**

- `activity-detected` (Rust ‚Üí Frontend)
- `idle-state-update` (Frontend ‚Üí Idle Window)
- `resume-tracking` / `stop-tracking` (Idle Window ‚Üí Main Window)

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ**, –Ω–æ:

- –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –º–µ–ª–∫–∏—Ö –∫–æ–º–∞–Ω–¥ - –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ —Å–µ—Ä–≤–∏—Å—ã
- –ù–µ—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –¥–ª—è events (TypeScript –Ω–µ –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É payload)

### 1.3 –ì–¥–µ –∂–∏–≤—ë—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ**

- –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏: `src/components/Timer.tsx` + `src/store/useTrackerStore.ts`
- Idle detection: `src/store/useTrackerStore.ts` (checkIdleStatus)
- URL tracking: `src/App.tsx` (useEffect)
- –°–∫—Ä–∏–Ω—à–æ—Ç—ã: `src/App.tsx` (useEffect)

**Rust backend –¥–µ–ª–∞–µ—Ç —Ç–æ–ª—å–∫–æ:**

- –°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (screenshots, mouse position)
- HTTP –∑–∞–ø—Ä–æ—Å—ã (upload_screenshot)
- Activity monitoring (mouse position)

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**

- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ (—Ç–∞–π–º–µ—Ä, idle) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ Rust
- Frontend –¥–æ–ª–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### 1.4 –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–ù–ï–¢ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –Ω–∞:**

- ‚ùå Engine (—Ç–∞–π–º–µ—Ä, —Ä–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏)
- ‚ùå Services (API, storage)
- ‚ùå State (Zustand - —Ç–æ–ª—å–∫–æ –¥–ª—è UI state)

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç enterprise-—É—Ä–æ–≤–Ω—é**

---

## 2. –¢–ê–ô–ú–ï–†

### 2.1 –ö–∞–∫ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤—Ä–µ–º—è

**–ò—Å—Ç–æ—á–Ω–∏–∫ –≤—Ä–µ–º–µ–Ω–∏:** `Date.now()` (JavaScript)

```typescript
// src/components/Timer.tsx
const now = Date.now();
const sessionElapsed = Math.floor((now - freshSessionStartTime) / 1000);
const totalElapsed = serverDuration + sessionElapsed;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–ú–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è**

- `Date.now()` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω–∏—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è ‚Üí —Ç–∞–π–º–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ "–ø—Ä—ã–∂–∫–∏" –≤—Ä–µ–º–µ–Ω–∏

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –¥–ª—è time tracking**

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Instant` –≤ Rust (–º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–µ –≤—Ä–µ–º—è)

### 2.2 –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞

**–•—Ä–∞–Ω–∏–ª–∏—â–µ:**

1. **Zustand store** (`useTrackerStore`) - –≤ –ø–∞–º—è—Ç–∏
2. **localStorage** - –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:
   - `hubnity_dayStartTime` / `hubnity_dayStartDate`
   - `hubnity_accumulatedTime` / `hubnity_accumulatedDate`

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è **–ù–µ—Ç SQLite/IndexedDB**

- localStorage –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
- –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –Ω–∞–¥–µ–∂–Ω–æ**

### 2.3 –ü–µ—Ä–µ–∂–∏–≤–∞–µ—Ç –ª–∏ —Ç–∞–π–º–µ—Ä —Å–æ–±—ã—Ç–∏—è

#### ‚úÖ –°–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ–∫–Ω–∞

- **–î–∞** - Tauri –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ñ–æ–Ω–µ
- Activity monitoring –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

#### ‚ö†Ô∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ UI

- **–ß–∞—Å—Ç–∏—á–Ω–æ** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∏–∑ localStorage
- –ù–æ `sessionStartTime` —Ç–µ—Ä—è–µ—Ç—Å—è ‚Üí —Ç–∞–π–º–µ—Ä –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è

#### ‚ùå Sleep / Wake OS

- **–ù–ï–¢ –æ–±—Ä–∞–±–æ—Ç–∫–∏** - –Ω–µ—Ç —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- –ü–æ—Å–ª–µ wake —Ç–∞–π–º–µ—Ä –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (–µ—Å–ª–∏ —Å–∏—Å—Ç–µ–º–∞ "—Å–ø–∞–ª–∞" 2 —á–∞—Å–∞, —Ç–∞–π–º–µ—Ä –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –ø—Ä–æ—à–ª–æ 2 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã)

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

### 2.4 –ú–æ–∂–Ω–æ –ª–∏ –≤—Ä—É—á–Ω—É—é –ø–æ–¥–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è

**–î–∞, –ª–µ–≥–∫–æ:**

1. –ò–∑–º–µ–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è ‚Üí `Date.now()` –≤–µ—Ä–Ω–µ—Ç –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
2. –ò–∑–º–µ–Ω–∏—Ç—å localStorage ‚Üí —Ç–∞–π–º–µ—Ä –ø–æ–∫–∞–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è
3. –ù–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–∏

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å**

---

## 3. –°–û–°–¢–û–Ø–ù–ò–Ø (State Machine)

### 3.1 –ö–∞–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—Ç

**–°–æ—Å—Ç–æ—è–Ω–∏—è –≤ `useTrackerStore`:**

- `isTracking: boolean` - —Ç—Ä–µ–∫–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω
- `isPaused: boolean` - –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- `idlePauseStartTime: number | null` - –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Å—Ç–æ—è
- `currentTimeEntry: TimeEntry | null` - —Ç–µ–∫—É—â–∞—è –∑–∞–ø–∏—Å—å

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ö†Ô∏è **–ù–µ—Ç —Å—Ç—Ä–æ–≥–æ–π state machine**

**–í–æ–∑–º–æ–∂–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏:**

- `isTracking=true, isPaused=false` - RUNNING
- `isTracking=true, isPaused=true` - PAUSED
- `isTracking=false, isPaused=false` - STOPPED
- `isTracking=false, isPaused=true` - **–ù–ï–í–û–ó–ú–û–ñ–ù–û, –Ω–æ –∫–æ–¥ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç**

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–π**

### 3.2 –ï—Å—Ç—å –ª–∏ —Å—Ç—Ä–æ–≥–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã

**–ù–ï–¢** - –ø–µ—Ä–µ—Ö–æ–¥—ã –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**

```typescript
// –ú–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å resumeTracking() –∫–æ–≥–¥–∞ isPaused=false
// –ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–æ –Ω–µ –±—Ä–æ—Å–∞–µ—Ç –æ—à–∏–±–∫—É, –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è
if (!isPaused) {
  return; // –¢–∏—Ö–∏–π –≤—ã—Ö–æ–¥
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–ù–µ—Ç —Å—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤**

### 3.3 Edge cases

**–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:**

1. ‚ùå –î–≤–æ–π–Ω–æ–π `startTracking()` - –∑–∞—â–∏—Ç–∞ –µ—Å—Ç—å (`isLoading`), –Ω–æ –Ω–µ –∏–¥–µ–∞–ª—å–Ω–∞—è
2. ‚ùå `pauseTracking()` –≤–æ –≤—Ä–µ–º—è `startTracking()` - –≤–æ–∑–º–æ–∂–µ–Ω race condition
3. ‚ùå –°–º–µ–Ω–∞ –¥–Ω—è –≤–æ –≤—Ä–µ–º—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –Ω–æ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
4. ‚ùå –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Ç—Ä–µ–∫–∏–Ω–≥–∞ - —á–∞—Å—Ç–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **Edge cases —á–∞—Å—Ç–∏—á–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã**

---

## 4. IDLE DETECTION

### 4.1 –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ª–∏ idle

**–î–∞, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω**

**–ú–µ—Ö–∞–Ω–∏–∑–º:**

1. Rust: `start_activity_monitoring()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç mouse position –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
2. Frontend: `checkIdleStatus()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `lastActivityTime` –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
3. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ threshold (2 –º–∏–Ω—É—Ç—ã) ‚Üí `pauseTracking(isIdlePause=true)`

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å**

### 4.2 –ò—Å—Ç–æ—á–Ω–∏–∫ —Å–æ–±—ã—Ç–∏–π

**macOS:**

- Mouse position —á–µ—Ä–µ–∑ `NSEvent.mouseLocation` (Objective-C FFI)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ–ª–∫–∏—Ö –¥–≤–∏–∂–µ–Ω–∏–π (< 20 –ø–∏–∫—Å–µ–ª–µ–π)

**–î—Ä—É–≥–∏–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**

- –ó–∞–≥–ª—É—à–∫–∞ - –ø—Ä–æ—Å—Ç–æ —ç–º–∏—Ç–∏—Ç —Å–æ–±—ã—Ç–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ mouse, –Ω–µ—Ç keyboard activity**

### 4.3 –ü–æ—Å–ª–µ –∫–∞–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ idle

**Threshold:** 2 –º–∏–Ω—É—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–†–∞–∑—É–º–Ω–æ**

### 4.4 –ó–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ª–∏ idle –≤ —Ç—Ä–µ–∫–∏–Ω–≥

**–ù–ï–¢** - –ø—Ä–∏ idle —Ç—Ä–µ–∫–∏–Ω–≥ –ø–∞—É–∑–∏—Ç—Å—è

**–õ–æ–≥–∏–∫–∞:**

```typescript
if (idleTime >= idleThreshold) {
  await pauseTracking(true); // isIdlePause=true
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ** (–∫–∞–∫ –≤ HubStaff)

---

## 5. –ê–ö–¢–ò–í–ù–û–°–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø

### 5.1 –¢—Ä–µ–∫–∞–µ—Ç—Å—è –ª–∏ –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ / –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–°—Ç–∞—Ç—É—Å:** ‚ùå **–û–¢–ö–õ–Æ–ß–ï–ù–û**

**–ü—Ä–∏—á–∏–Ω–∞:** Objective-C exceptions –∫—Ä–∞—à–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ö–æ–¥:**

```rust
// src-tauri/src/lib.rs:609
async fn get_active_window_info() -> Result<ActiveWindowInfo, String> {
    #[cfg(target_os = "macos")]
    {
        // Temporarily disable to prevent Objective-C exceptions from crashing the app
        return Ok(ActiveWindowInfo {
            app_name: None,
            window_title: None,
            url: None,
            domain: None,
        });
    }
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**

### 5.2 –ß–∞—Å—Ç–æ—Ç–∞ —Å–±–æ—Ä–∞

**URL tracking:** –ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥ (–µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω)

**Activity monitoring:** –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É (mouse position)

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–†–∞–∑—É–º–Ω–æ**

### 5.3 –ê–≥–≥—Ä–µ–≥–∞—Ü–∏—è vs real-time

**–ê–≥–≥—Ä–µ–≥–∞—Ü–∏—è:**

- URL activities –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤–µ `urlActivities`
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –±–∞—Ç—á–∞–º–∏ –ø–æ 100

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ** (—ç–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞)

---

## 6. –°–ö–†–ò–ù–®–û–¢–´

### 6.1 –ö–∞–∫ —á–∞—Å—Ç–æ –¥–µ–ª–∞—é—Ç—Å—è

**–ò–Ω—Ç–µ—Ä–≤–∞–ª:** –°–ª—É—á–∞–π–Ω—ã–π, 1-10 –º–∏–Ω—É—Ç

```typescript
const getRandomInterval = (): number => {
  const minMinutes = 1;
  const maxMinutes = 10;
  const randomMinutes = Math.random() * (maxMinutes - minMinutes) + minMinutes;
  return Math.floor(randomMinutes * 60 * 1000);
};
```

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–•–æ—Ä–æ—à–æ** (–Ω–µ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ)

### 6.2 –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è

**–ù–ï–¢ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞** - —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Å—Ä–∞–∑—É –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä

**–ü—Ä–æ–±–ª–µ–º–∞:** ‚ùå **–ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã —Ç–µ—Ä—è—é—Ç—Å—è**

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

### 6.3 –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –Ω–µ—Ç —Å–µ—Ç–∏

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**

1. –°–∫—Ä–∏–Ω—à–æ—Ç –¥–µ–ª–∞–µ—Ç—Å—è
2. –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ‚Üí –æ—à–∏–±–∫–∞
3. –°–∫—Ä–∏–Ω—à–æ—Ç **—Ç–µ—Ä—è–µ—Ç—Å—è** (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

### 6.4 –ï—Å—Ç—å –ª–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ / –∑–∞—â–∏—Ç–∞

**–ù–ï–¢ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:**

- –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ base64 —á–µ—Ä–µ–∑ HTTPS
- –ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç —á—Ç–µ–Ω–∏—è —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **HTTPS –µ—Å—Ç—å, –Ω–æ –Ω–µ—Ç end-to-end —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**

---

## 7. OFFLINE & SYNC

### 7.1 –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

**–¢–æ–ª—å–∫–æ localStorage:**

- –¢–æ–∫–µ–Ω—ã
- `hubnity_dayStartTime` / `hubnity_accumulatedTime`
- –ù–µ—Ç SQLite / IndexedDB

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è production**

### 7.2 –ï—Å—Ç—å –ª–∏ –æ—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

**–ù–ï–¢** - –Ω–µ—Ç –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è:

- –°–∫—Ä–∏–Ω—à–æ—Ç–æ–≤
- URL activities (—á–∞—Å—Ç–∏—á–Ω–æ - –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏, –Ω–æ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ)

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

### 7.3 –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ 4xx / 5xx

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**

- 401 ‚Üí token refresh (—Å queue)
- –î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏ ‚Üí –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–¢–æ–ª—å–∫–æ token refresh –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è**

### 7.4 –ï—Å—Ç—å –ª–∏ retry / backoff

**–¢–æ–ª—å–∫–æ –¥–ª—è token refresh:**

```typescript
// src/lib/api.ts:177
if (error.response?.status === 401 && !originalRequest._retry) {
  // Retry with refreshed token
}
```

**–î–ª—è –¥—Ä—É–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:** ‚ùå **–ù–ï–¢**

**–û—Ü–µ–Ω–∫–∞:** ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

---

## 8. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### 8.1 –ü–æ—Ç–æ–∫–∏ / async

**Rust:**

- `tokio::spawn` –¥–ª—è activity monitoring
- Async –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ `async fn`
- Mutex –¥–ª—è shared state (`ActivityMonitor`)

**Frontend:**

- Async/await –≤–µ–∑–¥–µ
- `setInterval` / `setTimeout` –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ**

### 8.2 –ï—Å—Ç—å –ª–∏ blocking IO

**–ù–ï–¢** - –≤—Å–µ IO async

**–û—Ü–µ–Ω–∫–∞:** ‚úÖ **–•–æ—Ä–æ—à–æ**

### 8.3 –ï—Å—Ç—å –ª–∏ unsafe

**–î–∞, 2 –º–µ—Å—Ç–∞:**

```rust
// src-tauri/src/lib.rs:76
unsafe {
    let mouse_location: core_graphics::geometry::CGPoint =
        msg_send![ns_event_class, mouseLocation];
}
```

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è FFI, –Ω–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å @try/@catch –¥–ª—è Objective-C**

### 8.4 –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ race conditions

**–ó–∞—â–∏—Ç–∞ –µ—Å—Ç—å:**

- `isLoading` —Ñ–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥–≤–æ–π–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
- Mutex –≤ Rust –¥–ª—è `ActivityMonitor`
- Queue –¥–ª—è token refresh

**–ù–æ –≤–æ–∑–º–æ–∂–Ω—ã:**

- Race –º–µ–∂–¥—É `pauseTracking()` –∏ `resumeTracking()`
- Race –º–µ–∂–¥—É `startTracking()` –∏ `stopTracking()`

**–û—Ü–µ–Ω–∫–∞:** ‚ö†Ô∏è **–ß–∞—Å—Ç–∏—á–Ω–æ –∑–∞—â–∏—â–µ–Ω–æ**

---

## 9. –°–û–û–¢–í–ï–¢–°–¢–í–ò–ï HUBSTAFF-LIKE –°–¢–ê–ù–î–ê–†–¢–ê–ú

### 9.1 –ß–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–æ —É—Ä–æ–≤–Ω—è HubStaff

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã:**

1. ‚ùå **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (SQLite)** - HubStaff —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω–æ
2. ‚ùå **Offline queue** - HubStaff —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
3. ‚ùå **Sleep/wake handling** - HubStaff –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π sleep
4. ‚ùå **Active window tracking** - HubStaff —Ç—Ä–µ–∫–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
5. ‚ùå **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏** - HubStaff –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä–≤–µ—Ä–Ω–æ–µ –≤—Ä–µ–º—è
6. ‚ùå **Retry/backoff –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** - HubStaff –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –Ω–µ—É–¥–∞—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
7. ‚ùå **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–∫—Ä–∏–Ω—à–æ—Ç–æ–≤** - HubStaff —à–∏—Ñ—Ä—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ

**–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã:**

1. ‚ö†Ô∏è **–°—Ç—Ä–æ–≥–∞—è state machine** - HubStaff –∏–º–µ–µ—Ç —á–µ—Ç–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
2. ‚ö†Ô∏è **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - HubStaff –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è
3. ‚ö†Ô∏è **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - HubStaff –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### 9.2 –ö–∞–∫–∏–µ —á–∞—Å—Ç–∏ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ö–æ—Ä–æ—à–æ:**

1. Daily timer reset (–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞ –¥–µ–Ω—å)
2. Idle detection (mouse position)
3. Idle window (–æ—Ç–¥–µ–ª—å–Ω–æ–µ –æ–∫–Ω–æ)
4. Token refresh —Å queue
5. URL activity tracking (–±–∞—Ç—á–∞–º–∏)
6. Screenshot capture (—Å resize)
7. Heartbeat (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)

### 9.3 –ß—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å

**TOP-5 –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤:**

1. **SQLite + Offline Queue** - –±–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ–ª—å–∑—è –≤ production
2. **Sleep/Wake handling** - —Ç–∞–π–º–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ—Å–ª–µ sleep
3. **Active window tracking** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
4. **Retry/Backoff** - –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
5. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–µ –≤—Ä–µ–º—è

---

## üìä –£–†–û–í–ï–ù–¨ –ó–†–ï–õ–û–°–¢–ò –ü–†–û–î–£–ö–¢–ê

### –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å: **MVP+ (–±–ª–∏–∑–∫–æ –∫ Production)**

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ E2E —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- ‚úÖ UI/UX –Ω–∞ –ø—Ä–∏–µ–º–ª–µ–º–æ–º —É—Ä–æ–≤–Ω–µ
- ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–µ–ª—ã –≤ offline/sync
- ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç edge cases (sleep/wake, –ø–æ–¥–º–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏)
- ‚ùå –ê–∫—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (window tracking) –æ—Ç–∫–ª—é—á–µ–Ω–∞

**–î–æ Production –Ω—É–∂–Ω–æ:**

1. SQLite + Offline Queue
2. Sleep/Wake handling
3. Retry/Backoff –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å Active window tracking
5. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ Production:** 2-3 –Ω–µ–¥–µ–ª–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

---

## üéØ TOP-5 –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ô (–ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É)

### 1. **SQLite + Offline Queue** (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ URL activities —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–µ—Ç–∏  
**–†–µ—à–µ–Ω–∏–µ:**

- –î–æ–±–∞–≤–∏—Ç—å `rusqlite` –≤ Rust
- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã: `screenshots_queue`, `url_activities_queue`, `time_entries_cache`
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–µ—Ç–∏
- **–í—Ä–µ–º—è:** 1 –Ω–µ–¥–µ–ª—è

### 2. **Sleep/Wake Handling** (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–∞–π–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ sleep  
**–†–µ—à–µ–Ω–∏–µ:**

- –î–æ–±–∞–≤–∏—Ç—å —Å–ª—É—à–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (Tauri events –¥–ª—è sleep/wake)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Instant::elapsed()` –≤–º–µ—Å—Ç–æ `Date.now()`
- –í—ã—á–∏—Ç–∞—Ç—å –≤—Ä–µ–º—è sleep –∏–∑ –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- **–í—Ä–µ–º—è:** 3-5 –¥–Ω–µ–π

### 3. **Active Window Tracking** (–ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–∑-–∑–∞ Objective-C exceptions  
**–†–µ—à–µ–Ω–∏–µ:**

- –û–±–µ—Ä–Ω—É—Ç—å Objective-C –≤—ã–∑–æ–≤—ã –≤ `@try/@catch` (—á–µ—Ä–µ–∑ FFI wrapper)
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ (Accessibility API)
- **–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

### 4. **Retry/Backoff –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** (–í–ê–ñ–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö  
**–†–µ—à–µ–Ω–∏–µ:**

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π retry –º–µ—Ö–∞–Ω–∏–∑–º –≤ `api.ts`
- Exponential backoff –¥–ª—è 5xx –æ—à–∏–±–æ–∫
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å –¥–ª—è 4xx –æ—à–∏–±–æ–∫
- **–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

### 5. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–¥–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏** (–í–ê–ñ–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–æ–∂–Ω–æ –ø–æ–¥–º–µ–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è  
**–†–µ—à–µ–Ω–∏–µ:**

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Instant` –≤ Rust (–º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–µ –≤—Ä–µ–º—è)
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è "–ø—Ä—ã–∂–∫–æ–≤" –≤—Ä–µ–º–µ–Ω–∏ (> 5 —Å–µ–∫—É–Ω–¥ —Ä–∞–∑–Ω–∏—Ü–∞)
- **–í—Ä–µ–º—è:** 2-3 –¥–Ω—è

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** MVP+ —Å —Ö–æ—Ä–æ—à–µ–π –±–∞–∑–æ–π, –Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–µ–ª–∞–º–∏

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**

- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Tauri 2.0
- –†–∞–±–æ—Ç–∞—é—â–∏–π idle detection
- Daily timer reset
- E2E —Ç–µ—Å—Ç—ã

**–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**

- –ù–µ—Ç offline –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ sleep/wake
- –ê–∫—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–∫–ª—é—á–µ–Ω–∞
- –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç –ø–æ–¥–º–µ–Ω—ã –≤—Ä–µ–º–µ–Ω–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å TOP-5 –ø—É–Ω–∫—Ç–æ–≤ –ø–µ—Ä–µ–¥ production —Ä–µ–ª–∏–∑–æ–º.

---

**–î–∞—Ç–∞:** 2025-01-06  
**–í–µ—Ä—Å–∏—è –∞–Ω–∞–ª–∏–∑–∞:** 1.0
